---
output: github_document
---

<!-- edit README.rmd -->

```{r knitr options, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)
devtools::load_all()
```

[![Travis](https://travis-ci.org/corybrunson/ordr.svg?branch=main)](https://travis-ci.org/corybrunson/ordr)

# ordr

**ordr** is designed to integrate ordination analysis and biplot visualization into a [**tidyverse**](https://github.com/tidyverse/tidyverse) workflow.

## motivation

### ordination and biplots

_Ordination_ is a catch-all term for a variety of statistical techniques that introduce an artificial coordinate system for a data set in such a way that a few coordinates capture a large amount of the data structure [^ordination].
The branch of mathematical statistics called [geometric data analysis](https://www.springer.com/us/book/9781402022357) (GDA) provides the theoretical basis for these techniques.
Together with regression, ordination can be contrasted to clustering and classification, in that they assign continuous rather than discrete values to data elements.

Most ordination techniques decompose a numeric rectangular data set into the product of two (or more) matrices. In some cases, such as principal components analysis, the decomposition is exact; in others, such as non-negative matrix factorization, it is approximate. Some techniques, such as correspondence analysis, transform the data before decomposition.
Ordination techniques may be supervised, like linear discriminant analysis, or unsupervised, like multidimensional scaling.
Analysis pipelines that use these techniques may use the artificial coordinates directly, in place of natural coordinates, to arrange and compare data elements or to predict responses. They also frequently use _biplots_ to represent the data elements that index the original table on a shared set of axes.

The underlying matrix decomposition usually produces two matrices, say _U_ and _V_, corresponding to the rows and to the columns of the original data matrix _X_: If _X_ has _n_ rows and _m_ columns, then _U_ and _V_ have _n_ rows and _m_ rows, respectively, and both have _r_ columns, with _r_ being the rank of the ordination [^lm-kmeans].
These _r_ columns provide a set of shared coordinates for the rows and columns of _X_. If _X_ contains a measured value for each of several variables (columns) on each of several cases (rows), then the ordination provides a space in which both cases and variables can be situated. If _X_ is a frequency table for two categorical variables, then the values of the two variables can be overlaid on the same _r_ shared coordinates. Such a scatterplot is called a biplot.

### implementations in R

An extensive range of ordination techniques are already implemented in R, from classical multidimensional scaling (`stats::cmdscale()`) and principal components analysis (`stats::prcomp()` and `stats::princomp()`) in the **stats** package distributed with base R, across widely-used implementations of linear discriminant analysis (`MASS::lda()`) and correspondence analysis (`ca::ca()`) in general-use statistical packages, to highly specialized packages that implement cutting-edge techniques or adapt conventional techniques to challenging settings. These implementations come with their own conventions, tailored to the research communities that produced them, and it would be impractical (and probably unhelpful) to try to consolidate them.

Instead, **ordr** provides a streamlined process by which the outputs of these methods&mdash;in particular, the matrix factors into which the original data are approximately decomposed and the artificial coordinates they share&mdash;can be inspected, annotated, tidied, and visualized. On this last point, most biplot implementations in R provide limited customizability, and **ordr** adopts the grammar of graphics paradigm from **ggplot2** to modularize biplot elements. The package as a whole is designed to follow the broader syntactic and grammatical conventions of the **tidyverse**, so that users familiar with a this workflow can more easily and quickly integrate ordination models into practice.

[^ordination]: The term _ordination_ is most prevalent among ecologists; to my knowledge, no catch-all term is in common use outside ecology.
[^lm-kmeans]: Regression and clustering models, like classical [linear regression](http://www.multivariatestatistics.org/chapter2.html) and [_k_-means](http://joelcadwell.blogspot.com/2015/08/matrix-factorization-comes-in-many.html), can also be understood as matrix decomposition approximations and even visualized in biplots. Their shared coordinates, which are pre-defined rather than artificial, are the predictor coefficients and the cluster assignments, respectively. Methods for `stats::lm()` and `stats::kmeans()`, for example, are implemented for the sake of novelty and instruction, but are not widely used in practice.

## usage

### installation

**ordr** remains under development and is not scheduled for a CRAN release. For now, it can be installed from the (default) `main` branch using [**remotes**](https://github.com/r-lib/remotes):

```{r install, eval=FALSE}
remotes::install_github("corybrunson/ordr")
```

### PCA example

Principal components analysis (PCA) is by far the most widely-used ordination technique.
This example performs an uncentered PCA on a small data set of personal expenditures over twenty years and represents the data in a symmetric biplot. At each step the result is printed, so that the user can see the effect of each step on the `prcomp` object.

```{r PCA example}
USPersonalExpenditure
# perform principal components analysis
(spend_pca <- prcomp(USPersonalExpenditure, center = FALSE))
# wrap the model as a `tbl_ord` object
(spend_pca <- as_tbl_ord(spend_pca))
# augment the cases and variables with metadata
(spend_pca <- augment(spend_pca))
# annotate the cases or variables
(spend_pca <- mutate_v(spend_pca, year = as.integer(.name)))
# confer inertia equally between cases and variables
(spend_pca <- confer_inertia(spend_pca, c(.5, .5)))
# render a biplot, by default on the first two shared coordinates
ggbiplot(spend_pca, aes(label = .name)) +
  theme_bw() +
  geom_v_vector(aes(color = year)) +
  geom_v_text_radiate() +
  geom_u_point() +
  geom_u_text_repel() +
  scale_y_continuous(expand = expand_scale(add = .5)) +
  ggtitle(
    "U.S. Personal Expenditure data, 1940-1960",
    "Symmetric biplot of un-centered PCA"
  )
```

### MDS example

Multidimensional scaling (MDS) is an ordination technique that starts not with rectangular data but with interpoint distances.
A common illustration of its power is to calculate MDS on the set of distances&mdash;however measured&mdash;between geographic locations, and to recover the approximate geography via a biplot. This example is adapted from the documentation of `cmdscale()` in the **stats** package; note that **ordr** masks `stats::cmdscale()` with a wrapper that always returns the eigenvalues and the symmetric distance matrix produced during the calculation.
The MDS uses 11 coordinates&mdash;the number of positive eigenvalues&mdash;so that `stat_*_spanningtree()` can call upon them to recover the intercity distances.

```{r MDS example}
# `tbl_ord` object for a classical MDS on distances between European cities
eurodist %>%
  cmdscale(k = 11) %>%
  as_tbl_ord() %>%
  augment() %>%
  negate_ord(2) %>%
  print() -> city_mds
# 2D biplot aligned with geography
city_mds %>%
  ggbiplot() +
  stat_v_spantree(
    ord_aes(city_mds), check.aes = FALSE,
    alpha = .5, linetype = "dotted"
  ) +
  geom_v_text(aes(label = .name), size = 3) +
  ggtitle("MDS biplot of road distances between European cities")
```

## acknowledgments

### contribute

Any feedback on the package is very welcome! If you encounter confusion or errors, please create an issue with a reproducible example. If you have requests, suggestions, or your own implementations for new features, feel free to create an issue or submit a pull request.
Methods for additional ordination classes (see the `methods-*.r` scripts in the `R` folder) are especially welcome, as are new plot layers.
Above all, be supportive!

### inspiration

This package was originally inspired by the **ggbiplot** extention developed by [vqv](https://github.com/vqv/ggbiplot), [richardjtelford](https://github.com/richardjtelford/ggbiplot), and [GegnzaV](https://github.com/GegznaV/ggbiplot), among others. So far as i know, it first brought biplots into the **tidyverse** framework.
The motivation to unify a variety of ordination methods came from [several books and articles](https://www.barcelonagse.eu/research/publications/all?author=Michael%20Greenacre) by Michael Greenacre.
Thomas Lin Pedersen's [**tidygraph**](https://github.com/thomasp85/tidygraph) sequel to **ggraph** finally induced the shift from simply generating scatterplots to upstream handling and manipulating ordination data.
